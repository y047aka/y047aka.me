<!doctype html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Saira:wght@400;500&amp;display=swap"><title>Elm での開発用テンプレート elm-starfighter を作った | y047aka.space</title><link rel="canonical" href="https://y047aka.space"><meta name="description" content="My Tanuki logo symbolizes this with a smart animal that works in a group to achieve a common goal."><meta property="og:title" content="Elm での開発用テンプレート elm-starfighter を作った"><meta property="og:type" content="article"><meta property="og:url" content="https://y047aka.space"><meta property="og:image" content="https://y047aka.space/M3fRFrmf.jpg"><meta property="og:site_name" content="y047aka.space"><meta property="og:description" content="My Tanuki logo symbolizes this with a smart animal that works in a group to achieve a common goal."><meta property="og:locale" content="ja_JP"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@y047aka"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css"><script src="https://kit.fontawesome.com/a26b6242ff.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/elm.min.js"></script><script>hljs.initHighlightingOnLoad()</script><style>._2064e38f{padding-top:20px;line-height:1.8;word-wrap:break-word}._2064e38f a{white-space:pre-wrap;text-decoration:none;color:#6c0}._2064e38f a:hover{text-decoration:underline}._2064e38f a:visited{color:#360}._2064e38f a[target=_blank]::after{content:"\f35d";position:relative;top:-1px;display:inline-block;padding:0 5px;font-family:"Font Awesome 5 Free";font-size:12px;font-weight:900;text-decoration:none;color:inherit}._2064e38f a[target=_blank]:visited::after{color:#360}._2064e38f table{border-spacing:0;border-collapse:collapse}._2064e38f td,._2064e38f th{padding:0}._2064e38f ol ol,._2064e38f ul ol{list-style-type:lower-roman}._2064e38f ol ol ol,._2064e38f ol ul ol,._2064e38f ul ol ol,._2064e38f ul ul ol{list-style-type:lower-alpha}._2064e38f blockquote+blockquote,._2064e38f blockquote+details,._2064e38f blockquote+dl,._2064e38f blockquote+ol,._2064e38f blockquote+p,._2064e38f blockquote+pre,._2064e38f blockquote+table,._2064e38f blockquote+ul,._2064e38f details+blockquote,._2064e38f details+details,._2064e38f details+dl,._2064e38f details+ol,._2064e38f details+p,._2064e38f details+pre,._2064e38f details+table,._2064e38f details+ul,._2064e38f dl+blockquote,._2064e38f dl+details,._2064e38f dl+dl,._2064e38f dl+ol,._2064e38f dl+p,._2064e38f dl+pre,._2064e38f dl+table,._2064e38f dl+ul,._2064e38f ol+blockquote,._2064e38f ol+details,._2064e38f ol+dl,._2064e38f ol+ol,._2064e38f ol+p,._2064e38f ol+pre,._2064e38f ol+table,._2064e38f ol+ul,._2064e38f p+blockquote,._2064e38f p+details,._2064e38f p+dl,._2064e38f p+ol,._2064e38f p+p,._2064e38f p+pre,._2064e38f p+table,._2064e38f p+ul,._2064e38f pre+blockquote,._2064e38f pre+details,._2064e38f pre+dl,._2064e38f pre+ol,._2064e38f pre+p,._2064e38f pre+pre,._2064e38f pre+table,._2064e38f pre+ul,._2064e38f table+blockquote,._2064e38f table+details,._2064e38f table+dl,._2064e38f table+ol,._2064e38f table+p,._2064e38f table+pre,._2064e38f table+table,._2064e38f table+ul,._2064e38f ul+blockquote,._2064e38f ul+details,._2064e38f ul+dl,._2064e38f ul+ol,._2064e38f ul+p,._2064e38f ul+pre,._2064e38f ul+table,._2064e38f ul+ul{margin-top:29px}._2064e38f hr{height:0;padding:0;margin:24px 0;border-top-width:1px;border-style:solid;border-color:#e1e4e8}._2064e38f blockquote{padding-left:1em;border-width:0;border-left-width:.25em;border-style:solid;color:#6a737d;border-color:#dfe2e5}._2064e38f h1,._2064e38f h2,._2064e38f h3,._2064e38f h4,._2064e38f h5,._2064e38f h6{font-weight:600}._2064e38f h1:nth-child(n+2),._2064e38f h2:nth-child(n+2),._2064e38f h3:nth-child(n+2),._2064e38f h4:nth-child(n+2),._2064e38f h5:nth-child(n+2),._2064e38f h6:nth-child(n+2){margin-top:29px}._2064e38f h1{margin:28px 0;padding:17px 0;font-size:1.125em;line-height:1.333;text-align:center;border-top:1px solid;border-bottom:1px solid}._2064e38f h2{margin-top:2px;margin-bottom:31px;font-size:1.25em;line-height:1.25}._2064e38f h3{font-size:1em}._2064e38f h4{font-size:1em}._2064e38f h5{font-size:.875em}._2064e38f h6{font-size:.85em;color:#6a737d}._2064e38f ol,._2064e38f ul{padding-left:2em}._2064e38f li:nth-child(n+2){margin-top:.25em}._2064e38f li>p{margin-top:16px}._2064e38f table{display:block;width:100%;overflow:auto}._2064e38f table th{font-weight:600}._2064e38f table td,._2064e38f table th{padding:6px 13px;border:1px solid #dfe2e5}._2064e38f table tr{background-color:#fff;border-top:1px solid #c6cbd1}._2064e38f table tr:nth-child(2n){background-color:#f6f8fa}._2064e38f img{max-width:100%}._2064e38f code,._2064e38f pre{font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;font-size:12px}._2064e38f code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}._2064e38f pre{word-wrap:normal}._2064e38f pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}._2064e38f pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}._2064e38f pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}._3a71fdb5{color:#797f85}._3a71fdb5>p{padding:5px 0;font-size:14px;line-height:1}._5758449e{display:block;width:620px;margin:0 auto;padding:20px 0;font-family:Saira,sans-serif;font-size:18px;font-weight:400}@media only screen and (max-width:480px){._5758449e{width:100%;padding:15px}}._6c2a7992{text-decoration:none;color:inherit}._96049fe0{padding:5px 0;font-family:"-apple-system",sans-serif;font-size:24px;font-weight:600}._beb10df7{width:620px;margin:0 auto;padding:20px 0}@media only screen and (max-width:480px){._beb10df7{width:100%;padding:15px}}._d8a7d977{display:block;width:620px;margin:0 auto;padding:20px 0;text-align:right;font-family:Saira,sans-serif;font-size:14px}@media only screen and (max-width:480px){._d8a7d977{width:100%;padding:15px}}._eca6e413{font-family:"-apple-system",BlinkMacSystemFont,sans-serif;font-feature-settings:"palt";color:#333}</style><style>html{box-sizing:border-box;-webkit-text-size-adjust:100%;word-break:normal;-moz-tab-size:4;tab-size:4}*,::after,::before{background-repeat:no-repeat;box-sizing:inherit}::after,::before{text-decoration:inherit;vertical-align:inherit}*{padding:0;margin:0}hr{overflow:visible;height:0}details,main{display:block}summary{display:list-item}small{font-size:80%}[hidden]{display:none}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}a{background:0 0}a:active,a:hover{outline-width:0}code,kbd,pre,samp{font-family:monospace,monospace}pre{font-size:1em}b,strong{font-weight:bolder}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}input{border-radius:0}[disabled]{cursor:default}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}textarea{overflow:auto;resize:vertical}button,input,optgroup,select,textarea{font:inherit}optgroup{font-weight:700}button{overflow:visible}button,select{text-transform:none}[role=button],[type=button],[type=reset],[type=submit],button{cursor:pointer;color:inherit}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button:-moz-focusring{outline:1px dotted ButtonText}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}button,input,select,textarea{background:0 0;border-style:none}select{-moz-appearance:none;-webkit-appearance:none}select::-ms-expand{display:none}select::-ms-value{color:currentColor}legend{border:0;color:inherit;display:table;max-width:100%;white-space:normal;max-width:100%}::-webkit-file-upload-button{-webkit-appearance:button;color:inherit;font:inherit}img{border-style:none}progress{vertical-align:baseline}svg:not([fill]){fill:currentColor}@media only screen{[hidden~=screen]{display:inherit}}@media only screen{[hidden~=screen]:not(:active):not(:focus):not(:target){position:absolute!important;clip:rect(0 0 0 0)!important}}[aria-busy=true]{cursor:progress}[aria-controls]{cursor:pointer}[aria-disabled]{cursor:default}</style><script src="/dynamic.js"></script></head><body class="_eca6e413"><header><h1 class="_5758449e"><a href="/" class="_6c2a7992">y047aka.space</a></h1></header><main class="_beb10df7"><header><h1 class="_96049fe0">Elm での開発用テンプレート elm-starfighter を作った</h1><div class="_3a71fdb5"><p><i class="fas fa-edit"></i> July 6th, 2019</p><p><i class="fas fa-redo-alt"></i> August 24th, 2019</p></div></header><div class="_2064e38f"><p>自作の Elm 開発用テンプレート「 <a href="https://github.com/y047aka/elm-starfighter" target="_blank" rel="noopener">elm-starfighter</a> 」が形になってきたので、その説明を書きます。</p><h1>elm-starfighter とは？</h1><p>関数型言語 <a href="https://elm-lang.org" target="_blank" rel="noopener">Elm</a> を使った Web アプリケーション開発用のテンプレートです。webpack や Parcel といったモジュールバンドラーを使用せず、<code>npm scripts</code> で完結しています。Elm での開発に最低限必要なものをシンプルに使えるのが、elm-starfighter の特徴です。</p><ul><li><a href="https://github.com/y047aka/elm-starfighter" target="_blank" rel="noopener">elm-starfighter</a></li></ul><h2>なぜ作ろうと思ったのか？</h2><p>JavaScript での開発と同様に、Elm においても webpack や Parcel を使った開発方法が普及しています。しかし、Elm はモジュールバンドラーを必要とはしていないかもしれません。それならばモジュールバンドラーに頼らない、よりシンプルな開発ができるのではないかと考えました。</p><p>既に知られている <a href="https://github.com/halfzebra/create-elm-app" target="_blank" rel="noopener">create-elm-app</a> や <a href="https://github.com/elm-community/elm-webpack-starter" target="_blank" rel="noopener">elm-webpack-starter</a> に対して「毎回使うには大きすぎる」と感じたことも動機の 1 つです。Elm 入門者が簡単に使える開発ツールがあれば、Elm の持つ魅力をもっと引き出せるのではないかと思います。</p><h2>開発の方針</h2><h3>Elm 入門者に優しく</h3><p>公式ガイドや『基礎からわかる Elm』を読んだあとで、すぐに使ってもらえるよう意識して作りました。使い方に迷うようなところがあれば改善していきたい。</p><h3>Elm の持つ魅力を引き出す</h3><p>JavaScript と Elm では何が違うのかを意識しながら作りました。標準の <code>elm make</code> コマンドはデバッグ機能を使うことができますし、そこに開発用サーバー機能を付加した <code>elm-live</code> も非常に強力です。それらの良さを残しつつ、苦手な部分を補うようにしました。</p><h3>モジュールバンドラーと戦わない</h3><p>適材適所を意識すること。例えば、Port を積極的に使うならモジュールバンドラーの方が有利のはず。
（私は Port をほとんど使わないので、推測で言っています）</p><h2>謝辞</h2><p>@ababup1192 さんには、開発初期の段階で多くの相談に乗っていただきました。ありがとうございました。</p><h1>簡単に使えるので書くことがない</h1><p>いちばん簡単な試し方は以下のコマンドを実行する方法です。</p><pre><code>$ git clone https://github.com/y047aka/elm-starfighter.git
$ cd elm-startfighter
$ npm install
$ npm start</code></pre><p>また、リポジトリのトップから緑色のボタン「Use this template」を選択すると、elm-starfighter を使った新しいリポジトリを作る事もできます。
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/406109/3faa5b0f-8ff3-9280-fa09-6ba62e3495e8.png" alt=""></p><h2>npm start</h2><p><code>npm start</code> を実行すると、</p><ol start="1"><li><code>docs</code> にファイルが生成され</li><li>開発用サーバーが起動し</li><li>ブラウザに最初のページが表示されます</li></ol><h2>npm run build</h2><p>もう 1 つのコマンドは <code>npm run build</code> で起動します。</p><ol start="1"><li><code>public</code> にファイルが生成されます</li></ol><p>生成前のファイルはすべて <code>src</code> にあるので、いつも通りに開発を進められます。</p><pre><code>src
 - index.html
 - main.js
 - Main.elm
 - style.sass または style.sass
 - assets（画像など）</code></pre><h2>ディレクトリ名について</h2><p><code>docs</code> は Github Pages を、<code>public</code> は Netlify をすぐに使えるよう意図して設定しています。</p><h1>おわり</h1><p>この記事の本編は、ここで終了です。
カスタマイズして使う場合には以下の付録を参考にしてください。</p><h1>付録 1： package.json を読む</h1><p>ここに elm-starfighter のすべてがあります。webpack や Parcel の姿はなく、代わりに <code>npm scripts</code> が並んでいます。<code>elm make</code> コマンドや <code>elm-live</code> を使っていることが分かりますね。これから <code>scripts</code> を詳しく見ていきましょう。</p><pre><code>{
  "scripts": {
    "clean": "rimraf docs public",
    "watch:html": "cpx -w src/index.html docs",
    "watch:assets": "cpx -w \"src/assets/**/*\" docs/assets",
    "watch:js": "cpx -w src/main.js docs",
    "watch:elm": "elm-live src/Main.elm --open --start-page=index.html --dir=docs -- --output=docs/elm.js",
    "watch:sass": "sass --watch src:docs",
    "watch": "sass src:docs &amp;&amp; npm-run-all -p watch:*",
    "compile:html": "cpx src/index.html public",
    "compile:assets": "cpx \"src/assets/**/*\" public/assets",
    "compile:js": "cpx src/main.js public",
    "compile:elm": "elm make src/Main.elm --optimize --output=public/elm.optimized.js",
    "compile:sass": "sass --style=compressed --no-source-map src:public",
    "compile": "npm-run-all -p compile:*",
    "minify:elm": "google-closure-compiler --js=public/elm.optimized.js --js_output_file=public/elm.js &amp;&amp; rimraf public/elm.optimized.js",
    "build": "npm-run-all -s clean compile minify:elm",
    "start": "npm-run-all -s clean watch",
    "test": "elm-test"
  },
  "devDependencies": {
    "cpx": "^1.5.0",
    "elm": "0.19.0-bugfix6",
    "elm-live": "3.4.0",
    "elm-test": "^0.19.0-rev6",
    "google-closure-compiler": "^20190819.0.0",
    "npm-run-all": "^4.1.5",
    "rimraf": "^3.0.0",
    "sass": "^1.22.10"
  }
}</code></pre><h2>npm scripts</h2><p>以下の 4 種類のコマンドを <code>start</code> と <code>build</code> から実行しています。</p><ul><li>clean</li><li>watch</li><li>compile</li><li>minify:elm</li></ul><h3>start</h3><p><code>clean</code> と <code>watch</code> を順番に実行します。</p><pre><code>"start": "npm-run-all -s clean watch"</code></pre><p>生成したファイルは <code>docs</code> に出力されます。出力先のディレクトリ名を変更する場合は、以下のコマンド内の <code>docs</code> を新しい名前に書き直します。（実際には package.json をエディタで一括変換すれば問題ありません）</p><h3>clean</h3><p><code>docs</code> と <code>public</code> ディレクトリを 2 つとも削除します。このコマンドのみ、<code>build</code> と共有しています。</p><pre><code>"clean": "rimraf docs public"</code></pre><h3>watch</h3><p>「watch:」で始まるコマンドを、すべて同時に実行します。それぞれが <code>src</code> のファイルを監視し、変更があれば <code>docs</code> に出力します。</p><pre><code>"watch:html": "cpx -w src/index.html docs",
"watch:assets": "cpx -w \"src/assets/**/*\" docs/assets",
"watch:js": "cpx -w src/main.js docs",
"watch:elm": "elm-live src/Main.elm --open --start-page=index.html --dir=docs -- --output=docs/elm.js",
"watch:sass": "sass --watch src:docs",
"watch": "sass src:docs &amp;&amp; npm-run-all -p watch:*"</code></pre><p>開発用のサーバーは <code>watch:elm</code> の elm-live が起動しています。</p><h3>build</h3><p><code>clean</code> <code>compile</code> <code>minify:elm</code> を順番に実行しています。</p><pre><code>"build": "npm-run-all -s clean compile minify:elm",</code></pre><p>生成したファイルは <code>public</code> に出力されます。出力先のディレクトリ名を変更する場合は、以下のコマンド内の <code>public</code> を新しい名前に書き直します。</p><h3>compile</h3><p>「compile:」で始まるコマンドを、すべて同時に実行します。</p><pre><code>"compile:html": "cpx src/index.html public",
"compile:assets": "cpx \"src/assets/**/*\" public/assets",
"compile:js": "cpx src/main.js public",
"compile:elm": "elm make src/Main.elm --optimize --output=public/elm.optimized.js",
"compile:sass": "sass --style=compressed --no-source-map src:public"
"compile": "npm-run-all -p compile:*"</code></pre><p><strong>注意：</strong> minify まで実行しないと elm.js を出力できない実装になっています。cpx でどうにかしたい。（2019 年 7 月 6 日）</p><h3>minify:elm</h3><p>elm.optimized.js を圧縮し、elm.js として出力します。</p><pre><code>"minify:elm": "google-closure-compiler --js=public/elm.optimized.js --js_output_file=public/elm.js &amp;&amp; rimraf public/elm.optimized.js"</code></pre><h1>付録 2： devDependencies</h1><p>使用した npm のパッケージについて簡単にコメントします。</p><h3>cpx</h3><p>ファイル・フォルダのコピーを、Mac でも Windows でも出来るように。
<code>--watch</code> のオプションがあり、<code>devDependencies</code> の記述量を減らすことに繋がった。
（内部的には chokidar かな？）
cpx で上手くいかない場合は、ncp で妥協することになる。</p><h3>elm</h3><p>Elm のコンパイラ。</p><h3>elm-live</h3><p>browser-sync を試したものの、コンパイルエラーを無視してサーバーが起動してしまうため、 elm-live が最適という結論になった。</p><h3>elm-test</h3><p>テスト（script 未実装）</p><h3>google-closure-compiler</h3><p>Elm をコンパイルした後の js ファイルを圧縮する。
elm-minify が deprecated となり、こちらが推奨されていたので使用した。</p><h3><s><p>node-sass</p></s></h3><s><p>SASS を扱うために使用。いつか sass（Dart Sass）に変えるかもしれない。</p></s><p>sass（Dart Sass）に変更しました。（2019 年 7 月 9 日）</p><h3>npm-run-all</h3><p>コマンドの直列実行と並列実行を読みやすく記述できる。</p><h3>rimraf</h3><p>フォルダの削除を、Mac でも Windows でも出来るように。</p></div></main><footer><p class="_d8a7d977">© 2020 y047aka</p></footer></body></html>