<!doctype html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Saira:wght@400;500&amp;display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500&amp;display=swap"><title>Elmでの開発用テンプレート elm-starfighter を作った | y047aka.space</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/elm.min.js"></script><script>hljs.initHighlightingOnLoad()</script><style>._6c2a7992{text-decoration:none;color:inherit}._72df195c{font-family:Saira,"Noto Sans JP",sans-serif;color:#333}._947c09d{display:block;width:620px;margin:0 auto;padding:20px 0;text-align:right;font-size:14px}@media only screen and (max-width:480px){._947c09d{width:100%;padding:15px}}._beb10df7{width:620px;margin:0 auto;padding:20px 0}@media only screen and (max-width:480px){._beb10df7{width:100%;padding:15px}}._c119abdc{display:block;width:620px;margin:0 auto;padding:20px 0;font-size:18px;font-weight:400}@media only screen and (max-width:480px){._c119abdc{width:100%;padding:15px}}._e448c0e2{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:"-apple-system",BlinkMacSystemFont,"Segoe UI",Helvetica,"Arial,sans-serif","Apple Color Emoji","Segoe UI Emoji";font-size:16px;line-height:1.6;word-wrap:break-word}._e448c0e2 details{display:block}._e448c0e2 summary{display:list-item}._e448c0e2 a{color:#0366d6;text-decoration:none}._e448c0e2 a:hover{text-decoration:underline}._e448c0e2 table{border-spacing:0;border-collapse:collapse}._e448c0e2 td,._e448c0e2 th{padding:0}._e448c0e2 h1,._e448c0e2 h2,._e448c0e2 h3,._e448c0e2 h4,._e448c0e2 h5,._e448c0e2 h6{margin-top:0;margin-bottom:0}._e448c0e2 h1{font-size:32px}._e448c0e2 h1,._e448c0e2 h2{font-weight:600}._e448c0e2 h2{font-size:24px}._e448c0e2 h3{font-size:20px}._e448c0e2 h3,._e448c0e2 h4{font-weight:600}._e448c0e2 h4{font-size:16px}._e448c0e2 h5{font-size:14px}._e448c0e2 h5,._e448c0e2 h6{font-weight:600}._e448c0e2 h6{font-size:12px}._e448c0e2 p{margin-top:0;margin-bottom:10px}._e448c0e2 blockquote{margin:0}._e448c0e2 ol,._e448c0e2 ul{padding-left:0;margin-top:0;margin-bottom:0}._e448c0e2 ol ol,._e448c0e2 ul ol{list-style-type:lower-roman}._e448c0e2 ol ol ol,._e448c0e2 ol ul ol,._e448c0e2 ul ol ol,._e448c0e2 ul ul ol{list-style-type:lower-alpha}._e448c0e2 dd{margin-left:0}._e448c0e2 code,._e448c0e2 pre{font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;font-size:12px}._e448c0e2 pre{margin-top:0;margin-bottom:0}._e448c0e2 blockquote,._e448c0e2 details,._e448c0e2 dl,._e448c0e2 ol,._e448c0e2 p,._e448c0e2 pre,._e448c0e2 table,._e448c0e2 ul{margin-top:0;margin-bottom:25px}._e448c0e2 hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}._e448c0e2 blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}._e448c0e2 blockquote>:first-child{margin-top:0}._e448c0e2 blockquote>:last-child{margin-bottom:0}._e448c0e2 h1,._e448c0e2 h2,._e448c0e2 h3,._e448c0e2 h4,._e448c0e2 h5,._e448c0e2 h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}._e448c0e2 h1{margin:1.5em 0;font-size:1.4em;font-weight:700;line-height:3;text-align:center;border-top:1px solid;border-bottom:1px solid}._e448c0e2 h2{font-size:1.4em}._e448c0e2 h3{font-size:1em}._e448c0e2 h4{font-size:1em}._e448c0e2 h5{font-size:.875em}._e448c0e2 h6{font-size:.85em;color:#6a737d}._e448c0e2 ol,._e448c0e2 ul{padding-left:2em}._e448c0e2 ol ol,._e448c0e2 ol ul,._e448c0e2 ul ol,._e448c0e2 ul ul{margin-top:0;margin-bottom:0}._e448c0e2 li{word-wrap:break-all}._e448c0e2 li+li{margin-top:.25em}._e448c0e2 li>p{margin-top:16px}._e448c0e2 dl{padding:0}._e448c0e2 dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}._e448c0e2 dl dd{padding:0 16px;margin-bottom:16px}._e448c0e2 table{display:block;width:100%;overflow:auto}._e448c0e2 table th{font-weight:600}._e448c0e2 table td,._e448c0e2 table th{padding:6px 13px;border:1px solid #dfe2e5}._e448c0e2 table tr{background-color:#fff;border-top:1px solid #c6cbd1}._e448c0e2 table tr:nth-child(2n){background-color:#f6f8fa}._e448c0e2 img{max-width:100%;box-sizing:initial;background-color:#fff}._e448c0e2 img[align=right]{padding-left:20px}._e448c0e2 img[align=left]{padding-right:20px}._e448c0e2 code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}._e448c0e2 pre{word-wrap:normal}._e448c0e2 pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}._e448c0e2 pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}._e448c0e2 pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}</style><style>html{box-sizing:border-box;-webkit-text-size-adjust:100%;word-break:normal;-moz-tab-size:4;tab-size:4}*,::after,::before{background-repeat:no-repeat;box-sizing:inherit}::after,::before{text-decoration:inherit;vertical-align:inherit}*{padding:0;margin:0}hr{overflow:visible;height:0}details,main{display:block}summary{display:list-item}small{font-size:80%}[hidden]{display:none}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}a{background:0 0}a:active,a:hover{outline-width:0}code,kbd,pre,samp{font-family:monospace,monospace}pre{font-size:1em}b,strong{font-weight:bolder}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}input{border-radius:0}[disabled]{cursor:default}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}textarea{overflow:auto;resize:vertical}button,input,optgroup,select,textarea{font:inherit}optgroup{font-weight:700}button{overflow:visible}button,select{text-transform:none}[role=button],[type=button],[type=reset],[type=submit],button{cursor:pointer;color:inherit}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button:-moz-focusring{outline:1px dotted ButtonText}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}button,input,select,textarea{background:0 0;border-style:none}select{-moz-appearance:none;-webkit-appearance:none}select::-ms-expand{display:none}select::-ms-value{color:currentColor}legend{border:0;color:inherit;display:table;max-width:100%;white-space:normal;max-width:100%}::-webkit-file-upload-button{-webkit-appearance:button;color:inherit;font:inherit}img{border-style:none}progress{vertical-align:baseline}svg:not([fill]){fill:currentColor}@media only screen{[hidden~=screen]{display:inherit}}@media only screen{[hidden~=screen]:not(:active):not(:focus):not(:target){position:absolute!important;clip:rect(0 0 0 0)!important}}[aria-busy=true]{cursor:progress}[aria-controls]{cursor:pointer}[aria-disabled]{cursor:default}</style><script src="/app.js"></script></head><body class="_72df195c"><header><h1 class="_c119abdc"><a href="/" class="_6c2a7992">y047aka.space</a></h1></header><main class="_beb10df7"><nav><a href="/" class="prev">home</a></nav><h2>Elmでの開発用テンプレート elm-starfighter を作った</h2><article class="_e448c0e2"><div><p>自作の Elm 開発用テンプレート「 <a href="https://github.com/y047aka/elm-starfighter">elm-starfighter</a> 」が形になってきたので、その説明を書きます。</p>
<h1 id="elm-starfighter-">elm-starfighter とは？</h1>
<p>関数型言語 <a href="https://elm-lang.org">Elm</a> を使った Web アプリケーション開発用のテンプレートです。webpack や Parcel といったモジュールバンドラーを使用せず、<code>npm scripts</code> で完結しています。Elm での開発に最低限必要なものをシンプルに使えるのが、elm-starfighter の特徴です。</p>
<ul>
<li><a href="https://github.com/y047aka/elm-starfighter">elm-starfighter</a></li>
</ul>
<h2 id="-">なぜ作ろうと思ったのか？</h2>
<p>JavaScript での開発と同様に、Elm においても webpack や Parcel を使った開発方法が普及しています。しかし、Elm はモジュールバンドラーを必要とはしていないかもしれません。それならばモジュールバンドラーに頼らない、よりシンプルな開発ができるのではないかと考えました。</p>
<p>既に知られている <a href="https://github.com/halfzebra/create-elm-app">create-elm-app</a> や <a href="https://github.com/elm-community/elm-webpack-starter">elm-webpack-starter</a> に対して「毎回使うには大きすぎる」と感じたことも動機の 1 つです。Elm 入門者が簡単に使える開発ツールがあれば、Elm の持つ魅力をもっと引き出せるのではないかと思います。</p>
<h2 id="-">開発の方針</h2>
<h3 id="elm-">Elm 入門者に優しく</h3>
<p>公式ガイドや『基礎からわかる Elm』を読んだあとで、すぐに使ってもらえるよう意識して作りました。使い方に迷うようなところがあれば改善していきたい。</p>
<h3 id="elm-">Elm の持つ魅力を引き出す</h3>
<p>JavaScript と Elm では何が違うのかを意識しながら作りました。標準の <code>elm make</code> コマンドはデバッグ機能を使うことができますし、そこに開発用サーバー機能を付加した <code>elm-live</code> も非常に強力です。それらの良さを残しつつ、苦手な部分を補うようにしました。</p>
<h3 id="-">モジュールバンドラーと戦わない</h3>
<p>適材適所を意識すること。例えば、Port を積極的に使うならモジュールバンドラーの方が有利のはず。
（私は Port をほとんど使わないので、推測で言っています）</p>
<h2 id="-">謝辞</h2>
<p>@ababup1192 さんには、開発初期の段階で多くの相談に乗っていただきました。ありがとうございました。</p>
<h1 id="-">簡単に使えるので書くことがない</h1>
<p>いちばん簡単な試し方は以下のコマンドを実行する方法です。</p>
<pre><code>$ git clone https://github.com/y047aka/elm-starfighter.git
$ cd elm-startfighter
$ npm install
$ npm start
</code></pre><p>また、リポジトリのトップから緑色のボタン「Use this template」を選択すると、elm-starfighter を使った新しいリポジトリを作る事もできます。
<img width="305" alt="スクリーンショット 2019-07-06 6.21.56.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/406109/3faa5b0f-8ff3-9280-fa09-6ba62e3495e8.png"></p>
<h2 id="npm-start">npm start</h2>
<p><code>npm start</code> を実行すると、</p>
<ol>
<li><code>docs</code> にファイルが生成され</li>
<li>開発用サーバーが起動し</li>
<li>ブラウザに最初のページが表示されます</li>
</ol>
<h2 id="npm-run-build">npm run build</h2>
<p>もう 1 つのコマンドは <code>npm run build</code> で起動します。</p>
<ol>
<li><code>public</code> にファイルが生成されます</li>
</ol>
<p>生成前のファイルはすべて <code>src</code> にあるので、いつも通りに開発を進められます。</p>
<pre><code>src
 - index.html
 - main.js
 - Main.elm
 - style.sass または style.sass
 - assets（画像など）
</code></pre><h2 id="-">ディレクトリ名について</h2>
<p><code>docs</code> は Github Pages を、<code>public</code> は Netlify をすぐに使えるよう意図して設定しています。</p>
<h1 id="-">おわり</h1>
<p>この記事の本編は、ここで終了です。
カスタマイズして使う場合には以下の付録を参考にしてください。</p>
<h1 id="-1-package-json-">付録 1： package.json を読む</h1>
<p>ここに elm-starfighter のすべてがあります。webpack や Parcel の姿はなく、代わりに <code>npm scripts</code> が並んでいます。<code>elm make</code> コマンドや <code>elm-live</code> を使っていることが分かりますね。これから <code>scripts</code> を詳しく見ていきましょう。</p>
<pre><code class="lang-package.json">{
  "scripts": {
    "clean": "rimraf docs public",
    "watch:html": "cpx -w src/index.html docs",
    "watch:assets": "cpx -w \"src/assets/**/*\" docs/assets",
    "watch:js": "cpx -w src/main.js docs",
    "watch:elm": "elm-live src/Main.elm --open --start-page=index.html --dir=docs -- --output=docs/elm.js",
    "watch:sass": "sass --watch src:docs",
    "watch": "sass src:docs &amp;&amp; npm-run-all -p watch:*",
    "compile:html": "cpx src/index.html public",
    "compile:assets": "cpx \"src/assets/**/*\" public/assets",
    "compile:js": "cpx src/main.js public",
    "compile:elm": "elm make src/Main.elm --optimize --output=public/elm.optimized.js",
    "compile:sass": "sass --style=compressed --no-source-map src:public",
    "compile": "npm-run-all -p compile:*",
    "minify:elm": "google-closure-compiler --js=public/elm.optimized.js --js_output_file=public/elm.js &amp;&amp; rimraf public/elm.optimized.js",
    "build": "npm-run-all -s clean compile minify:elm",
    "start": "npm-run-all -s clean watch",
    "test": "elm-test"
  },
  "devDependencies": {
    "cpx": "^1.5.0",
    "elm": "0.19.0-bugfix6",
    "elm-live": "3.4.0",
    "elm-test": "^0.19.0-rev6",
    "google-closure-compiler": "^20190819.0.0",
    "npm-run-all": "^4.1.5",
    "rimraf": "^3.0.0",
    "sass": "^1.22.10"
  }
}
</code></pre>
<h2 id="npm-scripts">npm scripts</h2>
<p>以下の 4 種類のコマンドを <code>start</code> と <code>build</code> から実行しています。</p>
<ul>
<li>clean</li>
<li>watch</li>
<li>compile</li>
<li>minify:elm</li>
</ul>
<h3 id="start">start</h3>
<p><code>clean</code> と <code>watch</code> を順番に実行します。</p>
<pre><code class="lang-json">"start": "npm-run-all -s clean watch"
</code></pre>
<p>生成したファイルは <code>docs</code> に出力されます。出力先のディレクトリ名を変更する場合は、以下のコマンド内の <code>docs</code> を新しい名前に書き直します。（実際には package.json をエディタで一括変換すれば問題ありません）</p>
<h3 id="clean">clean</h3>
<p><code>docs</code> と <code>public</code> ディレクトリを 2 つとも削除します。このコマンドのみ、<code>build</code> と共有しています。</p>
<pre><code class="lang-json">"clean": "rimraf docs public"
</code></pre>
<h3 id="watch">watch</h3>
<p>「watch:」で始まるコマンドを、すべて同時に実行します。それぞれが <code>src</code> のファイルを監視し、変更があれば <code>docs</code> に出力します。</p>
<pre><code class="lang-json">"watch:html": "cpx -w src/index.html docs",
"watch:assets": "cpx -w \"src/assets/**/*\" docs/assets",
"watch:js": "cpx -w src/main.js docs",
"watch:elm": "elm-live src/Main.elm --open --start-page=index.html --dir=docs -- --output=docs/elm.js",
"watch:sass": "sass --watch src:docs",
"watch": "sass src:docs &amp;&amp; npm-run-all -p watch:*"
</code></pre>
<p>開発用のサーバーは <code>watch:elm</code> の elm-live が起動しています。</p>
<h3 id="build">build</h3>
<p><code>clean</code> <code>compile</code> <code>minify:elm</code> を順番に実行しています。</p>
<pre><code class="lang-json">"build": "npm-run-all -s clean compile minify:elm",
</code></pre>
<p>生成したファイルは <code>public</code> に出力されます。出力先のディレクトリ名を変更する場合は、以下のコマンド内の <code>public</code> を新しい名前に書き直します。</p>
<h3 id="compile">compile</h3>
<p>「compile:」で始まるコマンドを、すべて同時に実行します。</p>
<pre><code class="lang-json">"compile:html": "cpx src/index.html public",
"compile:assets": "cpx \"src/assets/**/*\" public/assets",
"compile:js": "cpx src/main.js public",
"compile:elm": "elm make src/Main.elm --optimize --output=public/elm.optimized.js",
"compile:sass": "sass --style=compressed --no-source-map src:public"
"compile": "npm-run-all -p compile:*"
</code></pre>
<p><strong>注意：</strong> minify まで実行しないと elm.js を出力できない実装になっています。cpx でどうにかしたい。（2019 年 7 月 6 日）</p>
<h3 id="minify-elm">minify:elm</h3>
<p>elm.optimized.js を圧縮し、elm.js として出力します。</p>
<pre><code class="lang-json">"minify:elm": "google-closure-compiler --js=public/elm.optimized.js --js_output_file=public/elm.js &amp;&amp; rimraf public/elm.optimized.js"
</code></pre>
<h1 id="-2-devdependencies">付録 2： devDependencies</h1>
<p>使用した npm のパッケージについて簡単にコメントします。</p>
<h3 id="cpx">cpx</h3>
<p>ファイル・フォルダのコピーを、Mac でも Windows でも出来るように。
<code>--watch</code> のオプションがあり、<code>devDependencies</code> の記述量を減らすことに繋がった。
（内部的には chokidar かな？）
cpx で上手くいかない場合は、ncp で妥協することになる。</p>
<h3 id="elm">elm</h3>
<p>Elm のコンパイラ。</p>
<h3 id="elm-live">elm-live</h3>
<p>browser-sync を試したものの、コンパイルエラーを無視してサーバーが起動してしまうため、 elm-live が最適という結論になった。</p>
<h3 id="elm-test">elm-test</h3>
<p>テスト（script 未実装）</p>
<h3 id="google-closure-compiler">google-closure-compiler</h3>
<p>Elm をコンパイルした後の js ファイルを圧縮する。
elm-minify が deprecated となり、こちらが推奨されていたので使用した。</p>
<h3 id="-node-sass-"><del>node-sass</del></h3>
<p><del>SASS を扱うために使用。いつか sass（Dart Sass）に変えるかもしれない。</del>
sass（Dart Sass）に変更しました。（2019 年 7 月 9 日）</p>
<h3 id="npm-run-all">npm-run-all</h3>
<p>コマンドの直列実行と並列実行を読みやすく記述できる。</p>
<h3 id="rimraf">rimraf</h3>
<p>フォルダの削除を、Mac でも Windows でも出来るように。</p>
</div></article></main><footer><p class="_947c09d">© 2020 y047aka</p></footer></body></html>