<!doctype html>
<html><head><meta charset="utf-8"><title>Elmでの開発用テンプレート elm-starfighter を作った | y047aka.space</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Saira:wght@400;700&amp;display=swap"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/elm.min.js"></script><script>hljs.initHighlightingOnLoad()</script><style>._32f6b2ec{display:flex;flex-direction:column;min-height:100vh;font-family:Saira,sans-serif;color:#333}._32f6b2ec>main{flex:1}._6c2a7992{text-decoration:none;color:inherit}._72a1bd77{padding:20px 20px}._7b2a7d0d{width:620px;margin:0 auto;padding:20px 0}._84da74c4{width:620px;margin:0 auto}._87d1ed51{display:block;width:620px;margin:0 auto;font-size:18px;font-weight:400}._df60168e{padding:20px 20px;text-align:right;font-size:14px}._e80aba3c{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.5;color:#24292e;font-size:16px;line-height:1.5;word-wrap:break-word}._e80aba3c details{display:block}._e80aba3c summary{display:list-item}._e80aba3c a{color:#0366d6;text-decoration:none}._e80aba3c a:hover{text-decoration:underline}._e80aba3c table{border-spacing:0;border-collapse:collapse}._e80aba3c td,._e80aba3c th{padding:0}._e80aba3c h1,._e80aba3c h2,._e80aba3c h3,._e80aba3c h4,._e80aba3c h5,._e80aba3c h6{margin-top:0;margin-bottom:0}._e80aba3c h1{font-size:32px}._e80aba3c h1,._e80aba3c h2{font-weight:600}._e80aba3c h2{font-size:24px}._e80aba3c h3{font-size:20px}._e80aba3c h3,._e80aba3c h4{font-weight:600}._e80aba3c h4{font-size:16px}._e80aba3c h5{font-size:14px}._e80aba3c h5,._e80aba3c h6{font-weight:600}._e80aba3c h6{font-size:12px}._e80aba3c p{margin-top:0;margin-bottom:10px}._e80aba3c blockquote{margin:0}._e80aba3c ol,._e80aba3c ul{padding-left:0;margin-top:0;margin-bottom:0}._e80aba3c ol ol,._e80aba3c ul ol{list-style-type:lower-roman}._e80aba3c ol ol ol,._e80aba3c ol ul ol,._e80aba3c ul ol ol,._e80aba3c ul ul ol{list-style-type:lower-alpha}._e80aba3c dd{margin-left:0}._e80aba3c code,._e80aba3c pre{font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;font-size:12px}._e80aba3c pre{margin-top:0;margin-bottom:0}._e80aba3c blockquote,._e80aba3c details,._e80aba3c dl,._e80aba3c ol,._e80aba3c p,._e80aba3c pre,._e80aba3c table,._e80aba3c ul{margin-top:0;margin-bottom:16px}._e80aba3c hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}._e80aba3c blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}._e80aba3c blockquote>:first-child{margin-top:0}._e80aba3c blockquote>:last-child{margin-bottom:0}._e80aba3c h1,._e80aba3c h2,._e80aba3c h3,._e80aba3c h4,._e80aba3c h5,._e80aba3c h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}._e80aba3c h1{font-size:2em}._e80aba3c h1,._e80aba3c h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}._e80aba3c h2{font-size:1.5em}._e80aba3c h3{font-size:1.25em}._e80aba3c h4{font-size:1em}._e80aba3c h5{font-size:.875em}._e80aba3c h6{font-size:.85em;color:#6a737d}._e80aba3c ol,._e80aba3c ul{padding-left:2em}._e80aba3c ol ol,._e80aba3c ol ul,._e80aba3c ul ol,._e80aba3c ul ul{margin-top:0;margin-bottom:0}._e80aba3c li{word-wrap:break-all}._e80aba3c li+li{margin-top:.25em}._e80aba3c li>p{margin-top:16px}._e80aba3c dl{padding:0}._e80aba3c dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}._e80aba3c dl dd{padding:0 16px;margin-bottom:16px}._e80aba3c table{display:block;width:100%;overflow:auto}._e80aba3c table th{font-weight:600}._e80aba3c table td,._e80aba3c table th{padding:6px 13px;border:1px solid #dfe2e5}._e80aba3c table tr{background-color:#fff;border-top:1px solid #c6cbd1}._e80aba3c table tr:nth-child(2n){background-color:#f6f8fa}._e80aba3c img{max-width:100%;box-sizing:initial;background-color:#fff}._e80aba3c img[align=right]{padding-left:20px}._e80aba3c img[align=left]{padding-right:20px}._e80aba3c code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}._e80aba3c pre{word-wrap:normal}._e80aba3c pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}._e80aba3c pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}._e80aba3c pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}</style><style>html{box-sizing:border-box;-webkit-text-size-adjust:100%;word-break:normal;-moz-tab-size:4;tab-size:4}*,::after,::before{background-repeat:no-repeat;box-sizing:inherit}::after,::before{text-decoration:inherit;vertical-align:inherit}*{padding:0;margin:0}hr{overflow:visible;height:0}details,main{display:block}summary{display:list-item}small{font-size:80%}[hidden]{display:none}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}a{background:0 0}a:active,a:hover{outline-width:0}code,kbd,pre,samp{font-family:monospace,monospace}pre{font-size:1em}b,strong{font-weight:bolder}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}input{border-radius:0}[disabled]{cursor:default}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}textarea{overflow:auto;resize:vertical}button,input,optgroup,select,textarea{font:inherit}optgroup{font-weight:700}button{overflow:visible}button,select{text-transform:none}[role=button],[type=button],[type=reset],[type=submit],button{cursor:pointer;color:inherit}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button:-moz-focusring{outline:1px dotted ButtonText}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}button,input,select,textarea{background:0 0;border-style:none}select{-moz-appearance:none;-webkit-appearance:none}select::-ms-expand{display:none}select::-ms-value{color:currentColor}legend{border:0;color:inherit;display:table;max-width:100%;white-space:normal;max-width:100%}::-webkit-file-upload-button{-webkit-appearance:button;color:inherit;font:inherit}img{border-style:none}progress{vertical-align:baseline}svg:not([fill]){fill:currentColor}@media only screen{[hidden~=screen]{display:inherit}}@media only screen{[hidden~=screen]:not(:active):not(:focus):not(:target){position:absolute!important;clip:rect(0 0 0 0)!important}}[aria-busy=true]{cursor:progress}[aria-controls]{cursor:pointer}[aria-disabled]{cursor:default}</style><script src="/app.js"></script></head><body class="_32f6b2ec"><header class="_72a1bd77"><h1 class="_87d1ed51"><a href="/" class="_6c2a7992">y047aka.space</a></h1></header><main class="_7b2a7d0d"><nav><a href="/" class="prev">home</a></nav><h2>Elmでの開発用テンプレート elm-starfighter を作った</h2><article class="_e80aba3c"><div><p>自作の Elm 開発用テンプレート「 <a href="https://github.com/y047aka/elm-starfighter">elm-starfighter</a> 」が形になってきたので、その説明を書きます。</p>
<h1 id="elm-starfighter-">elm-starfighter とは？</h1>
<p>関数型言語 <a href="https://elm-lang.org">Elm</a> を使った Web アプリケーション開発用のテンプレートです。webpack や Parcel といったモジュールバンドラーを使用せず、<code>npm scripts</code> で完結しています。Elm での開発に最低限必要なものをシンプルに使えるのが、elm-starfighter の特徴です。</p>
<ul>
<li><a href="https://github.com/y047aka/elm-starfighter">elm-starfighter</a></li>
</ul>
<h1 id="-">なぜ作ろうと思ったのか？</h1>
<p>JavaScript での開発と同様に、Elm においても webpack や Parcel を使った開発方法が普及しています。しかし、Elm はモジュールバンドラーを必要とはしていないかもしれません。それならばモジュールバンドラーに頼らない、よりシンプルな開発ができるのではないかと考えました。</p>
<p>既に知られている <a href="https://github.com/halfzebra/create-elm-app">create-elm-app</a> や <a href="https://github.com/elm-community/elm-webpack-starter">elm-webpack-starter</a> に対して「毎回使うには大きすぎる」と感じたことも動機の 1 つです。Elm 入門者が簡単に使える開発ツールがあれば、Elm の持つ魅力をもっと引き出せるのではないかと思います。</p>
<h1 id="-">開発の方針</h1>
<h3 id="elm-">Elm 入門者に優しく</h3>
<p>公式ガイドや『基礎からわかる Elm』を読んだあとで、すぐに使ってもらえるよう意識して作りました。使い方に迷うようなところがあれば改善していきたい。</p>
<h3 id="elm-">Elm の持つ魅力を引き出す</h3>
<p>JavaScript と Elm では何が違うのかを意識しながら作りました。標準の <code>elm make</code> コマンドはデバッグ機能を使うことができますし、そこに開発用サーバー機能を付加した <code>elm-live</code> も非常に強力です。それらの良さを残しつつ、苦手な部分を補うようにしました。</p>
<h3 id="-">モジュールバンドラーと戦わない</h3>
<p>適材適所を意識すること。例えば、Port を積極的に使うならモジュールバンドラーの方が有利のはず。
（私は Port をほとんど使わないので、推測で言っています）</p>
<h3 id="-">謝辞</h3>
<p>@ababup1192 さんには、開発初期の段階で多くの相談に乗っていただきました。ありがとうございました。</p>
<h1 id="-">簡単に使えるので書くことがない</h1>
<p>いちばん簡単な試し方は以下のコマンドを実行する方法です。</p>
<pre><code>$ git clone https://github.com/y047aka/elm-starfighter.git
$ cd elm-startfighter
$ npm install
$ npm start
</code></pre><p>また、リポジトリのトップから緑色のボタン「Use this template」を選択すると、elm-starfighter を使った新しいリポジトリを作る事もできます。
<img width="305" alt="スクリーンショット 2019-07-06 6.21.56.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/406109/3faa5b0f-8ff3-9280-fa09-6ba62e3495e8.png"></p>
<h3 id="npm-start">npm start</h3>
<p><code>npm start</code> を実行すると、</p>
<ol>
<li><code>docs</code> にファイルが生成され</li>
<li>開発用サーバーが起動し</li>
<li>ブラウザに最初のページが表示されます</li>
</ol>
<h3 id="npm-run-build">npm run build</h3>
<p>もう 1 つのコマンドは <code>npm run build</code> で起動します。</p>
<ol>
<li><code>public</code> にファイルが生成されます</li>
</ol>
<p>生成前のファイルはすべて <code>src</code> にあるので、いつも通りに開発を進められます。</p>
<pre><code>src
 - index.html
 - main.js
 - Main.elm
 - style.sass または style.sass
 - assets（画像など）
</code></pre><h3 id="-">ディレクトリ名について</h3>
<p><code>docs</code> は Github Pages を、<code>public</code> は Netlify をすぐに使えるよう意図して設定しています。</p>
<h1 id="-">おわり</h1>
<p>この記事の本編は、ここで終了です。
カスタマイズして使う場合には以下の付録を参考にしてください。</p>
<h1 id="-package-json-">付録： package.json を読む</h1>
<p>ここに elm-starfighter のすべてがあります。webpack や Parcel の姿はなく、代わりに <code>npm scripts</code> が並んでいます。<code>elm make</code> コマンドや <code>elm-live</code> を使っていることが分かりますね。これから <code>scripts</code> を詳しく見ていきましょう。</p>
<pre><code class="lang-package.json">{
  "scripts": {
    "clean": "rimraf docs public",
    "watch:html": "cpx -w src/index.html docs",
    "watch:assets": "cpx -w \"src/assets/**/*\" docs/assets",
    "watch:js": "cpx -w src/main.js docs",
    "watch:elm": "elm-live src/Main.elm --open --start-page=index.html --dir=docs -- --output=docs/elm.js",
    "watch:sass": "sass --watch src:docs",
    "watch": "sass src:docs &amp;&amp; npm-run-all -p watch:*",
    "compile:html": "cpx src/index.html public",
    "compile:assets": "cpx \"src/assets/**/*\" public/assets",
    "compile:js": "cpx src/main.js public",
    "compile:elm": "elm make src/Main.elm --optimize --output=public/elm.optimized.js",
    "compile:sass": "sass --style=compressed --no-source-map src:public",
    "compile": "npm-run-all -p compile:*",
    "minify:elm": "google-closure-compiler --js=public/elm.optimized.js --js_output_file=public/elm.js &amp;&amp; rimraf public/elm.optimized.js",
    "build": "npm-run-all -s clean compile minify:elm",
    "start": "npm-run-all -s clean watch",
    "test": "elm-test"
  },
  "devDependencies": {
    "cpx": "^1.5.0",
    "elm": "0.19.0-bugfix6",
    "elm-live": "3.4.0",
    "elm-test": "^0.19.0-rev6",
    "google-closure-compiler": "^20190819.0.0",
    "npm-run-all": "^4.1.5",
    "rimraf": "^3.0.0",
    "sass": "^1.22.10"
  }
}
</code></pre>
<h2 id="npm-scripts">npm scripts</h2>
<p>以下の 4 種類のコマンドを <code>start</code> と <code>build</code> から実行しています。</p>
<ul>
<li>clean</li>
<li>watch</li>
<li>compile</li>
<li>minify:elm</li>
</ul>
<h3 id="start">start</h3>
<p><code>clean</code> と <code>watch</code> を順番に実行します。</p>
<pre><code class="lang-json">"start": "npm-run-all -s clean watch"
</code></pre>
<p>生成したファイルは <code>docs</code> に出力されます。出力先のディレクトリ名を変更する場合は、以下のコマンド内の <code>docs</code> を新しい名前に書き直します。（実際には package.json をエディタで一括変換すれば問題ありません）</p>
<h4 id="clean">clean</h4>
<p><code>docs</code> と <code>public</code> ディレクトリを 2 つとも削除します。このコマンドのみ、<code>build</code> と共有しています。</p>
<pre><code class="lang-json">"clean": "rimraf docs public"
</code></pre>
<h4 id="watch">watch</h4>
<p>「watch:」で始まるコマンドを、すべて同時に実行します。それぞれが <code>src</code> のファイルを監視し、変更があれば <code>docs</code> に出力します。</p>
<pre><code class="lang-json">"watch:html": "cpx -w src/index.html docs",
"watch:assets": "cpx -w \"src/assets/**/*\" docs/assets",
"watch:js": "cpx -w src/main.js docs",
"watch:elm": "elm-live src/Main.elm --open --start-page=index.html --dir=docs -- --output=docs/elm.js",
"watch:sass": "sass --watch src:docs",
"watch": "sass src:docs &amp;&amp; npm-run-all -p watch:*"
</code></pre>
<p>開発用のサーバーは <code>watch:elm</code> の elm-live が起動しています。</p>
<h3 id="build">build</h3>
<p><code>clean</code> <code>compile</code> <code>minify:elm</code> を順番に実行しています。</p>
<pre><code class="lang-json">"build": "npm-run-all -s clean compile minify:elm",
</code></pre>
<p>生成したファイルは <code>public</code> に出力されます。出力先のディレクトリ名を変更する場合は、以下のコマンド内の <code>public</code> を新しい名前に書き直します。</p>
<h4 id="clean">clean</h4>
<p><code>docs</code> と <code>public</code> ディレクトリを 2 つとも削除します。このコマンドのみ、<code>start</code> と共有しています。</p>
<pre><code class="lang-json">"clean": "rimraf docs public"
</code></pre>
<h4 id="compile">compile</h4>
<p>「compile:」で始まるコマンドを、すべて同時に実行します。</p>
<pre><code class="lang-json">"compile:html": "cpx src/index.html public",
"compile:assets": "cpx \"src/assets/**/*\" public/assets",
"compile:js": "cpx src/main.js public",
"compile:elm": "elm make src/Main.elm --optimize --output=public/elm.optimized.js",
"compile:sass": "sass --style=compressed --no-source-map src:public"
"compile": "npm-run-all -p compile:*"
</code></pre>
<p><strong>注意：</strong> minify まで実行しないと elm.js を出力できない実装になっています。cpx でどうにかしたい。（2019 年 7 月 6 日）</p>
<h4 id="minify-elm">minify:elm</h4>
<p>elm.optimized.js を圧縮し、elm.js として出力します。</p>
<pre><code class="lang-json">"minify:elm": "google-closure-compiler --js=public/elm.optimized.js --js_output_file=public/elm.js &amp;&amp; rimraf public/elm.optimized.js"
</code></pre>
<h1 id="-devdependencies">付録： devDependencies</h1>
<p>使用した npm のパッケージについて簡単にコメントします。</p>
<h3 id="cpx">cpx</h3>
<p>ファイル・フォルダのコピーを、Mac でも Windows でも出来るように。
<code>--watch</code> のオプションがあり、<code>devDependencies</code> の記述量を減らすことに繋がった。
（内部的には chokidar かな？）
cpx で上手くいかない場合は、ncp で妥協することになる。</p>
<h3 id="elm">elm</h3>
<p>Elm のコンパイラ。</p>
<h3 id="elm-live">elm-live</h3>
<p>browser-sync を試したものの、コンパイルエラーを無視してサーバーが起動してしまうため、 elm-live が最適という結論になった。</p>
<h3 id="elm-test">elm-test</h3>
<p>テスト（script 未実装）</p>
<h3 id="google-closure-compiler">google-closure-compiler</h3>
<p>Elm をコンパイルした後の js ファイルを圧縮する。
elm-minify が deprecated となり、こちらが推奨されていたので使用した。</p>
<h3 id="-node-sass-"><del>node-sass</del></h3>
<p><del>SASS を扱うために使用。いつか sass（Dart Sass）に変えるかもしれない。</del>
sass（Dart Sass）に変更しました。（2019 年 7 月 9 日）</p>
<h3 id="npm-run-all">npm-run-all</h3>
<p>コマンドの直列実行と並列実行を読みやすく記述できる。</p>
<h3 id="rimraf">rimraf</h3>
<p>フォルダの削除を、Mac でも Windows でも出来るように。</p>
<h1 id="-">付録： 今後について</h1>
<p>バージョン 1.0 としてリリースするために残っているタスクなど。</p>
<h3 id="main-elm">Main.elm</h3>
<p>暫定的に作ってありますが、アイデアを思いついたら更新します。</p>
<p><del>また、<code>Browser.element</code> と <code>Browser.document</code> のどちらを提供するべきかでも迷っています。</del>
→ Browser.document が過剰だったので、Browser.element に変更しました。</p>
<h3 id="npm-scripts-">npm scripts の見直し</h3>
<p><del>クロスプラットフォーム対応を心がけましたが、手元に Windows 環境がないので未検証です。検証とプルリクエストをお待ちしています。</del>
→ ご協力ありがとうございました。</p>
<h3 id="elm-chagama-">elm-chagama （茶釜）</h3>
<p>elm-stargfighter 1 つで全ての開発ケースに対応することはできないので、最大公約数をとって耐えるのか他にもいくつかのテンプレートを作成するのかを考えています。後者はコンセプトだけ書きました。</p>
<ul>
<li><a href="https://elm-chagama.github.io/docs/">elm-chagama</a></li>
</ul>
</div></article></main><footer class="_df60168e"><p class="_84da74c4">© 2020 y047aka</p></footer></body></html>